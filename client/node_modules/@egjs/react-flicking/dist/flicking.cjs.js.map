{"version":3,"file":"flicking.cjs.js","sources":["../src/react-flicking/Clone.tsx","../src/react-flicking/consts.ts","../src/react-flicking/Flicking.tsx"],"sourcesContent":["import { Component } from \"react\";\n\nexport class CloneComponent extends Component {\n  public render() {\n    return this.props.children;\n  }\n}\n","import { ChangeEvent, FlickingEvent, SelectEvent, NeedPanelEvent, VisibleChangeEvent } from \"@egjs/flicking\";\nimport { FlickingProps } from \"./types\";\n\nexport const FLICKING_PROPS: FlickingProps = {\n  tag: \"div\",\n  viewportTag: \"div\",\n  cameraTag: \"div\",\n  classPrefix: \"eg-flick\",\n  plugins: [],\n  onNeedPanel: (e: NeedPanelEvent) => {},\n  onMoveStart: (e: FlickingEvent) => {},\n  onMove: (e: FlickingEvent) => {},\n  onMoveEnd: (e: FlickingEvent) => {},\n  onHoldStart: (e: FlickingEvent) => {},\n  onHoldEnd: (e: FlickingEvent) => {},\n  onRestore: (e: FlickingEvent) => {},\n  onSelect: (e: SelectEvent) => {},\n  onChange: (e: ChangeEvent) => {},\n  onVisibleChange: (e: VisibleChangeEvent) => {},\n};\n","import NativeFlicking, { FlickingOptions, Plugin, FlickingEvent, NeedPanelEvent, withFlickingMethods, DEFAULT_OPTIONS, VisibleChangeEvent } from \"@egjs/flicking\";\nimport * as React from \"react\";\nimport { CloneComponent } from \"./Clone\";\nimport { FLICKING_PROPS } from \"./consts\";\nimport { FlickingProps, FlickingType } from \"./types\";\nimport ListDiffer, { ListFormat } from \"@egjs/list-differ\";\nimport ChildrenDiffer from \"@egjs/children-differ\";\n\nclass Flicking extends React.Component<Partial<FlickingProps & FlickingOptions>> {\n  public static defaultProps: FlickingProps = FLICKING_PROPS;\n  public state: {\n    cloneCount: number,\n  } = {\n      cloneCount: 0,\n    };\n  // Flicking\n  @withFlickingMethods\n  private flicking?: NativeFlicking | null;\n  private options: FlickingOptions = {\n    ...DEFAULT_OPTIONS,\n    renderExternal: true,\n  };\n  // differ\n  private pluginsDiffer: ListDiffer<Plugin> = new ListDiffer<Plugin>();\n  private childrenDiffer: ChildrenDiffer<HTMLElement>;\n  private jsxDiffer: ListDiffer<string>;\n  private containerElement: HTMLElement;\n  private cameraElement: HTMLElement;\n\n  // life cycle\n  constructor(props: Partial<FlickingProps & FlickingOptions>) {\n    super(props);\n    const options = this.options;\n    for (const name in props) {\n      if (name in DEFAULT_OPTIONS) {\n        options[name] = props[name];\n      }\n    }\n  }\n\n  public render() {\n    const props = this.props;\n    /* tslint:disable:naming-convention */\n    const Tag = props.tag as any;\n    const Viewport = props.viewportTag as any;\n    const Camera = props.cameraTag as any;\n    /* tslint:enable:naming-convention */\n    const classPrefix = props.classPrefix;\n    const attributes: { [key: string]: any } = {};\n\n    for (const name in props) {\n      if (!(name in FLICKING_PROPS) && !(name in DEFAULT_OPTIONS)) {\n        attributes[name] = props[name];\n      }\n    }\n    return (\n      <Tag {...attributes} ref={e => {\n        e && (this.containerElement = e);\n      }}>\n        <Viewport className={`${classPrefix}-viewport`}>\n          <Camera className={`${classPrefix}-camera`} ref={e => {\n            e && (this.cameraElement = e);\n          }}>\n            {this.renderPanels()}\n          </Camera>\n        </Viewport>\n      </Tag>\n    );\n  }\n\n  public componentDidUpdate() {\n    const result = this.childrenDiffer!.update(this.getElements());\n    this.flicking!.sync(result);\n    this.checkPlugins();\n    this.checkCloneCount();\n  }\n\n  public componentDidMount() {\n    this.childrenDiffer = new ChildrenDiffer<HTMLElement>(this.getElements());\n    this.flicking = new NativeFlicking(\n      this.containerElement,\n      {\n        ...this.options,\n        framework: \"react\",\n        frameworkVersion: React.version,\n      } as object,\n    ).on({\n      moveStart: (e: FlickingEvent) => this.props.onMoveStart!(e),\n      move: (e: FlickingEvent) => this.props.onMove!(e),\n      moveEnd: (e: FlickingEvent) => this.props.onMoveEnd!(e),\n      holdStart: (e: FlickingEvent) => this.props.onHoldStart!(e),\n      holdEnd: (e: FlickingEvent) => this.props.onHoldEnd!(e),\n      select: (e: FlickingEvent) => this.props.onSelect!(e),\n      needPanel: (e: NeedPanelEvent) => this.props.onNeedPanel!(e),\n      change: (e: FlickingEvent) => this.props.onChange!(e),\n      restore: (e: FlickingEvent) => this.props.onRestore!(e),\n      visibleChange: (e: VisibleChangeEvent) => {\n        this.props.onVisibleChange!(e);\n        this.forceUpdate();\n      },\n    });\n    const children = this.getChildren();\n    this.jsxDiffer = new ListDiffer<string>(children.map(child => `${child.key}`));\n\n    if (this.props.status) {\n      this.setStatus(this.props.status);\n    }\n    this.checkPlugins();\n    this.checkCloneCount();\n\n    if (this.props.renderOnlyVisible) {\n      this.forceUpdate();\n    }\n  }\n\n  public componentWillUnmount() {\n    this.destroy({ preserveUI: true });\n  }\n\n  // private\n  private checkPlugins() {\n    const { list, added, removed, prevList } = this.pluginsDiffer.update(this.props.plugins!);\n\n    this.flicking!.addPlugins(added.map(index => list[index]));\n    this.flicking!.removePlugins(removed.map(index => prevList[index]));\n  }\n\n  private checkCloneCount() {\n    const cloneCount = this.flicking!.getCloneCount();\n\n    if (this.state.cloneCount !== cloneCount) {\n      this.setState({\n        cloneCount,\n      });\n    }\n  }\n\n  private renderPanels() {\n    const { renderOnlyVisible } = this.props;\n    const flicking = this.flicking;\n    const reactChildren = this.getChildren();\n    let panels: Array<React.ReactElement<any>>;\n\n    if (flicking && renderOnlyVisible) {\n      const diffResult = this.jsxDiffer.update(reactChildren.map(child => `${child.key}`));\n      const panelCnt = reactChildren.length;\n\n      flicking.beforeSync(diffResult);\n\n      const indexesToRender = flicking.getRenderingIndexes(diffResult);\n      panels = indexesToRender.map(index => {\n        if (index >= panelCnt) {\n          const relativeIndex = index % panelCnt;\n          const cloneIndex = Math.floor(index / panelCnt) - 1;\n          const origEl = reactChildren[relativeIndex];\n\n          return <CloneComponent key={`clone${cloneIndex}${origEl.key}`}>{origEl}</CloneComponent>;\n        } else {\n          return reactChildren[index];\n        }\n      });\n    } else {\n      const cloneCount = this.state.cloneCount;\n      panels = [...reactChildren];\n\n      for (let i = 0; i < cloneCount; ++i) {\n        panels = panels.concat(reactChildren.map(el => {\n          return <CloneComponent key={`clone${i}${el.key}`}>{el}</CloneComponent>;\n        }));\n      }\n    }\n\n    return panels;\n  }\n\n  private getChildren() {\n    const children = React.Children.toArray(this.props.children).slice() as Array<React.ReactElement<any>>;\n    return typeof this.props.lastIndex === \"number\"\n      ? children.slice(0, this.props.lastIndex + 1)\n      : children;\n  }\n\n  private getElements(): ListFormat<HTMLElement> {\n    return this.cameraElement.children as any;\n  }\n}\ninterface Flicking extends React.Component<Partial<FlickingProps & FlickingOptions>>, FlickingType<Flicking> { }\nexport default Flicking;\n"],"names":["tslib_1","props","children","Component","FLICKING_PROPS","tag","viewportTag","cameraTag","classPrefix","plugins","onNeedPanel","e","onMoveStart","onMove","onMoveEnd","onHoldStart","onHoldEnd","onRestore","onSelect","onChange","onVisibleChange","_super","_this","cloneCount","DEFAULT_OPTIONS","renderExternal","ListDiffer","options","name","Tag","Viewport","Camera","attributes","React","ref","containerElement","className","cameraElement","renderPanels","result","childrenDiffer","update","getElements","flicking","sync","checkPlugins","checkCloneCount","ChildrenDiffer","NativeFlicking","framework","frameworkVersion","on","moveStart","move","moveEnd","holdStart","holdEnd","select","needPanel","change","restore","visibleChange","forceUpdate","getChildren","jsxDiffer","map","child","key","status","setStatus","renderOnlyVisible","destroy","preserveUI","_a","list","added","removed","prevList","addPlugins","index","removePlugins","getCloneCount","state","setState","reactChildren","panels","diffResult","panelCnt_1","length","beforeSync","indexesToRender","getRenderingIndexes","relativeIndex","cloneIndex","Math","floor","origEl","CloneComponent","i","concat","el","toArray","slice","lastIndex","Flicking","withFlickingMethods"],"mappings":"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"}